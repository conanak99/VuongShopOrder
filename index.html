<!DOCTYPE html>
<html>

<head>
    <title>Đặt hàng Vuong Store</title>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link type="text/css" rel="stylesheet" href="css/materialize.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="css/custom.css" media="screen,projection" />
    <link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body ng-app="app" ng-controller="myCtrl">
    <nav class="amber darken-2" role="navigation">
        <div class="nav-wrapper container">
            <a id="logo-container" href="#" class="brand-logo center">Vuong Store</a>
        </div>
    </nav>
    <div class="container">
        <div class="section no-pad-bot">
            <div class="row center">
                <h3 class="orange-text text-accent-1 col s12">Order nhanh chóng và tiện lợi</h3>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col s8">
                <div class="row">
                    <h4>Chọn màu</h4>
                    <div id="colorSelect" class="row">
                        <img ng-src="images/passport/{{color.id}}.jpg" ng-class="{selected: color.isSelected}" ng-click="selectColor(color)" ng-repeat="color in colors" />
                    </div>
                    <h4>Chọn charm</h4>
                    <div id="charmSelect" class="row">
                        <img ng-src="images/charm/{{charm.img}}.png" ng-class="{selected: charm.isSelected}" ng-click="selectCharm(charm)" ng-repeat="charm in charms" />
                    </div>
                    <h4>Nhập tên (Tiếng Việt không dấu)</h4>
                    <div>
                        <div class="input-field col s12">
                            <i class="material-icons prefix">account_circle</i>
                            <input id="name" ng-model="name" type="text" class="validate">
                            <label id="lblName" for="name">Tên</label>
                        </div>
                    </div>
                    <h4>Thông tin giao hàng</h4>
                    <div class="row">
                        <div class="col s6">
                            <div class="input-field col s12">
                                <i class="material-icons prefix">phone</i>
                                <input id="phone" ng-model="order.phone" type="text" class="validate">
                                <label id="lblPhone" for="phone">Số điện thoại</label>
                            </div>
                        </div>
                        <div class="col s6">
                            <div class="input-field col s12">
                                <i class="material-icons prefix">home</i>
                                <input id="address" ng-model="order.address" type="text" class="validate">
                                <label id="lblAdress" for="address">Địa chỉ giao hàng</label>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <i class="material-icons prefix">comment</i>
                            <textarea id="note" ng-model="order.note" class="materialize-textarea"></textarea>
                            <label id="lblNotee" for="note">Ghi chú (Thời điểm giao, gặp anh/chị)</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col s4" id="passportImage">
                <div class="row">
                    <img ng-src="images/passport/{{selectedColorId}}.jpg" id="imgCover" />
                    <h5 id="lblNote" ng-bind="name"></h5>
                    <img ng-class="{long : selectedCharmId > 11}" ng-src="images/charm/{{selectedCharmId}}.png" id="imgCharm" />
                </div>
                <div class="row">
                    <h5>Sản phẩm đặt mua</h5>
                    <table id="cart" class="bordered">
                        <tr>
                            <th>Màu</th>
                            <th>Charm</th>
                            <th>Tên</th>
                            <th>&nbsp;</th>
                        </tr>
                        <tr ng-if="order.cart.length == 0">
                            <td colspan="4"></td>
                        </tr>
                        <tr ng-repeat="item in order.cart">
                            <td><img ng-src="images/passport/{{item.colorId}}.jpg" /></td>
                            <td><img ng-src="images/charm/{{item.charmId > 11 ? item.charmId + '_2' : item.charmId}}.png" /></td>
                            <td>{{item.name}}</td>
                            <td>
                                <button ng-click="remove(item)"> Xóa</button>
                            </td>
                        </tr>
                        <tr>
                            <td class="right-align" colspan="4">Tổng cộng: {{order.cart.length || 0}}</td>
                        </tr>
                    </table>
                    <div class="table-footer">
                        
                        <div>
                            <p>1. Chọn màu, charm và chữ bạn muốn khắc.</p>
                            <p>2. Bấm "Mua" để đặt mua 1 sản phẩm. Bạn có thể đặt mua nhiều sản phẩm khác màu, charm và chữ.</p>
                            <p>3. Sau khi mua ít nhất 1 sản phẩm, bấm "Đặt hàng" để thực hiện đặt hàng. Vui lòng điền đầy đủ thông tin giao hàng. </p>
                        </div>
                        <button ng-click="addToCart()" class="btn waves-effect waves-light" type="submit" name="action">
                            Mua  <i class="material-icons">shopping_cart</i>
                        </button>
                        <button ng-disable="order.cart.length < 1" ng-class="{disabled : order.cart.length < 1}" ng-click="submit()" class="btn waves-effect waves-light" type="submit" name="action">
                            Đặt hàng <i class="material-icons">shop</i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="page-footer amber darken-2">
        <div class="footer-copyright">
            <div class="container">
                Copyright by <a class="orange-text text-lighten-3" href="http://materializecss.com">H.Pham | Aswig Solutions</a>
            </div>
        </div>
    </footer>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.0/js/materialize.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.2/angular.min.js"></script>
    <script type="text/javascript" src="https://code.angularjs.org/1.4.2/angular-route.min.js"></script>
    <script>
    var app = angular.module('app', ['ngRoute']);

    app.controller('myCtrl', ['$scope', '$http', function($scope, $http) {

        loadCharmAndColor();
        loadOrder();

        $scope.selectColor = function(color) {
            $scope.colors.forEach(function(item) {
                item.isSelected = false;
            });
            color.isSelected = true;
            $scope.selectedColorId = color.id;
        };

        $scope.selectCharm = function(charm) {
            $scope.charms.forEach(function(item) {
                item.isSelected = false;
            });
            charm.isSelected = true;
            $scope.selectedCharmId = charm.id;
        };

        $scope.remove = function(item) {
            var itemIndex = $scope.order.cart.indexOf(item);
            $scope.order.cart.splice(itemIndex, 1);
        };

        $scope.addToCart = function() {
            $scope.order.cart.push({
                colorId: $scope.selectedColorId,
                charmId: $scope.selectedCharmId,
                name: $scope.name
            });
        }

        $scope.submit = function() {
            if ($scope.order.cart.length < 1) return;

            var apiLink = 'https://api.mongolab.com/api/1/databases/vuong_shop_order/collections/orders/?apiKey=Rds2DpkLY7_VqsMfmgfSo_EdzafbQvOs';
            $http.post(apiLink, $scope.order).then(function(rs) {
                var newId = rs.data._id['$oid'];
                var host = 'http://conanak99.github.io/VuongShopOrder/';
                // var host = 'file:///C:/Users/Huy%20Hoang/Source/Repos/VuongShopOrder/';
                var link = host + 'order.html#/?id=' + newId;

                prompt("Bạn đã đặt hàng thành công, hãy gửi link đơn hàng này cho facebook shop.\nLink đơn hàng:", link);
            });
        };

        function loadOrder() {
            $scope.selectedColorId = 1;
            $scope.selectedCharmId = 1,
                $scope.name = 'hoang';
            $scope.order = {
                phone: '',
                note: '',
                address: '',
                cart: []
            };
            selectCharmAndColor();
        }

        function loadCharmAndColor() {
            $scope.colors = [{
                id: 1,
                description: 'Màu 1'
            }, {
                id: 2,
                description: 'Màu 2'
            }, {
                id: 3,
                description: 'Màu 3'
            }, {
                id: 4,
                description: 'Màu 4'
            }, {
                id: 5,
                description: 'Màu 5'
            }, {
                id: 6,
                description: 'Màu 6'
            }, {
                id: 7,
                description: 'Màu 7'
            }, {
                id: 8,
                description: 'Màu 8'
            }, {
                id: 9,
                description: 'Màu 9'
            }, {
                id: 10,
                description: 'Màu 10'
            }, {
                id: 11,
                description: 'Màu 11'
            }, {
                id: 12,
                description: 'Màu 12'
            }];

            $scope.charms = [{
                id: 1,
                description: 'Charm 1',
                img: "1"
            }, {
                id: 2,
                description: 'Charm 2',
                img: "2"
            }, {
                id: 3,
                description: 'Charm 3',
                img: "3"
            }, {
                id: 4,
                description: 'Charm 4',
                img: "4"
            }, {
                id: 5,
                description: 'Charm 5',
                img: "5"
            }, {
                id: 6,
                description: 'Charm 6',
                img: "6"
            }, {
                id: 7,
                description: 'Charm 7',
                img: "7"
            }, {
                id: 8,
                description: 'Charm 8',
                img: "8"
            }, {
                id: 9,
                description: 'Charm 9',
                img: "9"
            }, {
                id: 10,
                description: 'Charm 10',
                img: '10'
            }, {
                id: 11,
                description: 'Charm 11',
                img: '11'
            }, {
                id: 12,
                description: 'Charm 12',
                img: '12_2'
            }, {
                id: 13,
                description: 'Charm 13',
                img: '13_2'
            }];
        }

        function selectCharmAndColor() {
            $scope.colors.forEach(function(item) {
                item.isSelected = item.id == $scope.selectedColorId;
            });

            $scope.charms.forEach(function(item) {
                item.isSelected = item.id == $scope.selectedCharmId;
            });
        }

    }]);
    </script>
</body>

</html>
